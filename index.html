<!DOCTYPE html>
<html>
<head>
  <title>Warning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background-color: #f4f4f4;
    }
    .box {
      background: white;
      padding: 40px;
      max-width: 500px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.15);
    }
    h1 {
      color: #cc0000;
    }
    #countdown {
      font-size: 42px;
      font-weight: bold;
      margin: 25px 0;
    }
    .progress-container {
      background: #ddd;
      border-radius: 8px;
      overflow: hidden;
      height: 14px;
      margin-bottom: 25px;
    }
    #progress {
      height: 100%;
      width: 0%;
      background: #007bff;
      transition: width 1s linear;
    }
    button {
      padding: 15px 30px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: not-allowed;
      background-color: #999;
      color: white;
    }
  </style>
</head>
<body>

<div class="box">
  <h1>âš  Warning</h1>
  <p>This content is from my personal history, It was never meant for you to view.</p>
  <p>You must wait 15 seconds before continuing.</p>

  <div id="countdown">15</div>

  <div class="progress-container">
    <div id="progress"></div>
  </div>

  <button id="accept" disabled>Accept & Continue</button>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzdH-T92c5nc7gPDP6bqvHL78XnWgTuKbqw1o5_qa4oKBuq8iAZxvvUppmN-T0zOXEeUw/exec";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "<h2>Invalid link</h2>";
}

const button = document.getElementById("accept");
const countdownDisplay = document.getElementById("countdown");
const progressBar = document.getElementById("progress");

const totalTime = 15;
let remaining = totalTime;

// Prevent refresh bypass
if (sessionStorage.getItem("timeLeft")) {
  remaining = parseInt(sessionStorage.getItem("timeLeft"));
} else {
  sessionStorage.setItem("timeLeft", totalTime);
}

const timer = setInterval(() => {
  remaining--;
  sessionStorage.setItem("timeLeft", remaining);

  countdownDisplay.innerText = remaining;

  const percent = ((totalTime - remaining) / totalTime) * 100;
  progressBar.style.width = percent + "%";

  if (remaining <= 0) {
    clearInterval(timer);
    sessionStorage.removeItem("timeLeft");

    countdownDisplay.innerText = "Ready";
    button.disabled = false;
    button.style.cursor = "pointer";
    button.style.backgroundColor = "#28a745";
  }
}, 1000);

// Load full JSON (working stable version)
fetch(scriptURL)
  .then(res => res.json())
  .then(data => {
    button.onclick = function() {
      if (data[id]) {
        window.location.href = data[id];
      } else {
        alert("Video not found.");
      }
    };
  });

// Prevent back button bypass
history.pushState(null, null, location.href);
window.onpopstate = function () {
  history.go(1);
};
</script>

</body>
</html>
