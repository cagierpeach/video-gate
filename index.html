<!DOCTYPE html>
<html>
<head>
  <title>SECURE SYSTEM ACCESS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      background: black;
      color: #00ff00;
      font-family: "Courier New", monospace;
      text-align: center;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, #001100 0%, black 80%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .box {
      width: 90%;
      max-width: 500px;
      padding: 40px;
      border: 2px solid #00ff00;
      box-shadow: 0 0 20px #00ff00;
      background: rgba(0, 0, 0, 0.9);
    }

    h1 {
      color: red;
      margin-bottom: 10px;
    }

    #countdown {
      font-size: 60px;
      font-weight: bold;
      margin: 20px 0;
    }

    .progress-container {
      background: #002200;
      height: 10px;
      margin: 20px 0;
      border: 1px solid #00ff00;
    }

    #progress {
      height: 100%;
      width: 0%;
      background: #00ff00;
      transition: width 1s linear;
    }

    .checkbox-container {
      margin: 20px 0;
      font-size: 14px;
    }

    button {
      padding: 12px 30px;
      font-size: 16px;
      border: 1px solid #00ff00;
      background: black;
      color: #00ff00;
      cursor: not-allowed;
    }

    button.active {
      background: #00ff00;
      color: black;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="overlay">
  <div class="box">
    <h1>⚠ NEW USER DETECTED ⚠</h1>
    <p>Verification in Progress...</p>
    <p>Private Internet History Archive</p>

    <div id="countdown">20</div>

    <div class="progress-container">
      <div id="progress"></div>
    </div>

    <div class="checkbox-container">
      <label>
        <input type="checkbox" id="agree">
        I understand I am chooseing to view a piece of the artists unfiltered internet history something not meant to ever be public
      </label>
    </div>

    <button id="accept" disabled>ACCESS SYSTEM</button>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzdH-T92c5nc7gPDP6bqvHL78XnWgTuKbqw1o5_qa4oKBuq8iAZxvvUppmN-T0zOXEeUw/exec";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "<h2 style='color:red'>INVALID SESSION</h2>";
}

const button = document.getElementById("accept");
const countdownDisplay = document.getElementById("countdown");
const progressBar = document.getElementById("progress");
const checkbox = document.getElementById("agree");

const totalTime = 20;
let remaining = totalTime;
let timerFinished = false;

// Persist timer on refresh
if (sessionStorage.getItem("timeLeft")) {
  remaining = parseInt(sessionStorage.getItem("timeLeft"));
} else {
  sessionStorage.setItem("timeLeft", totalTime);
}

function updateButtonState() {
  if (timerFinished && checkbox.checked) {
    button.disabled = false;
    button.classList.add("active");
  } else {
    button.disabled = true;
    button.classList.remove("active");
  }
}

const timer = setInterval(() => {
  remaining--;
  sessionStorage.setItem("timeLeft", remaining);

  countdownDisplay.innerText = remaining;

  const percent = ((totalTime - remaining) / totalTime) * 100;
  progressBar.style.width = percent + "%";

  if (remaining <= 0) {
    clearInterval(timer);
    sessionStorage.removeItem("timeLeft");

    countdownDisplay.innerText = "ACCESS GRANTED";
    timerFinished = true;
    updateButtonState();
  }
}, 1000);

checkbox.addEventListener("change", updateButtonState);

fetch(scriptURL)
  .then(res => res.json())
  .then(data => {
    button.onclick = function() {
      if (data[id]) {
        window.location.href = data[id];
      } else {
        alert("SYSTEM ERROR");
      }
    };
  });

// Prevent back button bypass
history.pushState(null, null, location.href);
window.onpopstate = function () {
  history.go(1);
};
</script>

</body>
</html>
